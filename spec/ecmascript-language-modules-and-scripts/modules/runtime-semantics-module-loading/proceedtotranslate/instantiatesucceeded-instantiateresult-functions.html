<!doctype html>
<es-clause title="InstantiateSucceeded(instantiateResult) Functions" anchor=
"sec-instantiatesucceeded-instantiateresult-functions">
  <p>An InstantiateSucceeded function is an anonymous function that handles the result of the
  <code>instantiate</code> hook.</p>

  <p>Each InstantiateSucceeded function has [[Loader]] and [[Load]] internal slots.</p>

  <p>When an InstantiateSucceeded function <es-nt>F</es-nt> is called with argument
  <es-nt>instantiateResult</es-nt>, the following steps are taken:</p>

  <ol class="proc">
    <li>Let <i>loader</i> be the value of <i>F</i>’s [[Loader]] <a href=
    "#sec-object-internal-methods-and-internal-slots">internal slot</a> .
    </li>

    <li>Let <i>load</i> be the value of <i>F</i>’s [[Load]] <a href=
    "#sec-object-internal-methods-and-internal-slots">internal slot</a> .
    </li>

    <li>If <i>load</i>.[[LinkSets]] is an empty <a href="#sec-list-and-record-specification-type">
      List</a> , return <b>undefined</b>.
    </li>

    <li>If <i>instantiateResult</i> is <b>undefined</b>, then

      <ol class="block">
        <li>Let <i>body</i> be the result of parsing <i>load</i>.[[Source]], interpreted as UTF-16
        encoded Unicode text as described in clause 10.1.1, using <i>Module</i> as the goal symbol.
        Throw a SyntaxError exception if the parse fails or if any static semantics errors are
        detected.</li>

        <li>Set <i>load</i>.[[Body]] to <i>body</i>.</li>

        <li>Set <i>load</i>.[[Kind]] to declarative.</li>

        <li>Let <i>depsList</i> be the ModuleRequests of <i>body</i>.</li>
      </ol>
    </li>

    <li>Else if <a href="#sec-ecmascript-data-types-and-values">Type</a> (<i>instantiateResult</i>)
    is Object, then

      <ol class="block">
        <li>Let <i>deps</i> be the result of <a href="#sec-get-o-p">Get</a>
        (<i>instantiateResult</i>, <code>"deps"</code>).
        </li>

        <li>
          <a href="#sec-returnifabrupt">ReturnIfAbrupt</a> (<i>deps</i>).
        </li>

        <li>If <i>deps</i> is undefined, then let <i>depsList</i> be a new empty <a href=
        "#sec-list-and-record-specification-type">List</a> .
        </li>

        <li>Else,

          <ol class="block">
            <li>Let <i>depsList</i> be the result of calling the IterableToArray abstract operation
            passing <i>deps</i> as the single argument.</li>

            <li>
              <a href="#sec-returnifabrupt">ReturnIfAbrupt</a> (<i>depsList</i>).
            </li>
          </ol>
        </li>

        <li>Let <i>execute</i> be the result of <a href="#sec-get-o-p">Get</a>
        (<i>instantiateResult</i>, <code>"execute"</code>).
        </li>

        <li>
          <a href="#sec-returnifabrupt">ReturnIfAbrupt</a> (<i>execute</i>).
        </li>

        <li>Set <i>load</i>.[[Execute]] to <i>execute</i>.</li>

        <li>Set <i>load</i>.[[Kind]] to dynamic.</li>
      </ol>
    </li>

    <li>Else,

      <ol class="block">
        <li>Throw a <b>TypeError</b> exception.</li>
      </ol>
    </li>

    <li>Return <a href="#sec-processloaddependencies">ProcessLoadDependencies</a> (<i>load</i>, <i>
      loader</i>, <i>depsList</i>).
    </li>
  </ol>
</es-clause>
