<!doctype html>
<es-clause title="NewFunctionEnvironment (F, T)" anchor="sec-newfunctionenvironment">
  <p>When the abstract operation NewFunctionEnvironment is called with an ECMAScript function
  Object <es-nt>F</es-nt> and an ECMAScript value <es-nt>T</es-nt> as arguments, the following
  steps are performed:</p>

  <ol class="proc">
    <li><es-xref target="sec-algorithm-conventions">Assert</es-xref>: The value of <i>F’s</i>
    [[ThisMode]] <es-xref target="sec-object-internal-methods-and-internal-slots">internal
    slot</es-xref> is not lexical.</li>

    <li>Let <i>env</i> be a new <es-xref target="sec-lexical-environments">Lexical
    Environment</es-xref>.</li>

    <li>Let <i>envRec</i> be a new <es-xref target="sec-function-environment-records">Function
    environment record</es-xref> containing containing no bindings.</li>

    <li>Set <i>envRec’s</i> <i>thisValue</i> to <i>T</i>.</li>

    <li>If <i>F</i>’s [[NeedsSuper]] <es-xref target=
    "sec-object-internal-methods-and-internal-slots">internal slot</es-xref> is <b>true</b>, then

      <ol class="block">
        <li>Let <i>home</i> be the value of <i>F’s</i> [[HomeObject]] <es-xref target=
        "sec-object-internal-methods-and-internal-slots">internal slot</es-xref>.</li>

        <li>If <i>home</i> is <b>undefined</b>, then throw a <b>ReferenceError</b> exception.</li>

        <li>Set <i>envRec’s</i> <i>HomeObject</i> to <i>home</i>.</li>

        <li>Set <i>envRec’s</i> <i>MethodName</i> to the value of <i>F’s</i> [[MethodName]]
        <es-xref target="sec-object-internal-methods-and-internal-slots">internal
        slot</es-xref>.</li>
      </ol>
    </li>

    <li>Else,

      <ol class="block">
        <li>Set <i>envRec’s</i> <i>HomeObject</i> to Empty.</li>
      </ol>
    </li>

    <li>Set <i>env’s</i> environment record to be <i>envRec</i>.</li>

    <li>Set the <es-xref target="sec-lexical-environments">outer lexical environment
    reference</es-xref> of <i>env</i> to the value of <i>F’s</i> [[Environment]] <es-xref target=
    "sec-object-internal-methods-and-internal-slots">internal slot</es-xref>.</li>

    <li>Return <i>env</i>.</li>
  </ol>
</es-clause>
