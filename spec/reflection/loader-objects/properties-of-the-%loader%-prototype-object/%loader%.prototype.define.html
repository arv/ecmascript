<!doctype html>
<es-clause title="%Loader%.prototype.define ( name, source, options = undefined )" anchor=
"sec-%loader%.prototype.define">
  <p>The <code>define</code> method installs a module in this <es-nt>loader</es-nt>'s module
  registry for <es-nt>source</es-nt> using <es-nt>name</es-nt> as the registry key. The module is
  not immediately available. The <code>translate</code> and <code>instantiate</code> hooks are
  called asynchronously, and dependencies are loaded asynchronously. <code>define</code> returns a
  Promise object that resolves to <es-nt>undefined</es-nt> when the new module and its dependencies
  are installed in the registry.</p>

  <p>When the <code>define</code> method is called with arguments <es-nt>name</es-nt>,
  <es-nt>source</es-nt>, and optional argument <es-nt>options</es-nt> the following steps are
  taken:</p>

  <ol class="proc">
    <li>Let <i>loader</i> be this Loader.</li>

    <li><es-xref target="sec-returnifabrupt">ReturnIfAbrupt</es-xref>(<i>loader</i>).</li>

    <li>Let <i>loaderRecord</i> be <i>loaderâ€™s</i> [[LoaderRecord]] <es-xref target=
    "sec-object-internal-methods-and-internal-slots">internal slot</es-xref>.</li>

    <li>Let <i>name</i> be <es-xref target="sec-tostring">ToString</es-xref>(<i>name</i>).</li>

    <li><es-xref target="sec-returnifabrupt">ReturnIfAbrupt</es-xref>(<i>name</i>).</li>

    <li>Let <i>address</i> be <es-xref target="sec-getoption">GetOption</es-xref>(<i>options</i>,
    <code>"address"</code>).</li>

    <li><es-xref target="sec-returnifabrupt">ReturnIfAbrupt</es-xref>(<i>address</i>).</li>

    <li>Let <i>metadata</i> be <es-xref target="sec-getoption">GetOption</es-xref>(<i>options</i>,
    <code>"metadata"</code>).</li>

    <li><es-xref target="sec-returnifabrupt">ReturnIfAbrupt</es-xref>(<i>metadata</i>).</li>

    <li>If <i>metadata</i> is <i>undefined</i> then let <i>metadata</i> be the result of calling
    <es-xref target="sec-objectcreate">ObjectCreate</es-xref>(%ObjectPrototype%).</li>

    <li>Let <i>p</i> be <es-xref target=
    "sec-promiseofstartloadpartwaythrough">PromiseOfStartLoadPartwayThrough</es-xref>(<code>"translate"</code>,
    <i>loaderRecord</i>, <i>name</i>, <i>metadata</i>, <i>source</i>, <i>address</i>).</li>

    <li><es-xref target="sec-returnifabrupt">ReturnIfAbrupt</es-xref>(<i>p</i>).</li>

    <li>Let <i>G</i> be a new function as defined by ReturnUndefined.</li>

    <li>Let <i>p</i> be the result of calling PromiseThen(<i>p</i>, <i>G</i>).</li>

    <li>Return <i>p</i>.</li>
  </ol>

  <p>The <code>length</code> property of the <code>define</code> method is <b>2</b>.</p>
</es-clause>
