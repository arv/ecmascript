<!doctype html>
<es-clause title="CreatePromiseCapabilityRecord( promise, constructor ) Abstract Operation" anchor=
"sec-createpromisecapabilityrecord">
  <ol class="proc">
    <li>Let <i>promiseCapability</i> be a new PromiseCapability { [[Promise]]: <i>promise</i>,
    [[Resolve]]: <b>undefined</b>, [[Reject]]: <b>undefined</b> }.</li>

    <li>Let <i>executor</i> be a new built-in function object as defined in <es-xref target=
    "sec-getcapabilitiesexecutor-functions">GetCapabilitiesExecutor Functions</es-xref>
    (<es-xref target="sec-createpromisecapabilityrecord">25.4.1.5.1</es-xref>).</li>

    <li>Set the [[Capability]] <es-xref target=
    "sec-object-internal-methods-and-internal-slots">internal slot</es-xref> of <i>executor</i> to
    <i>promiseCapability</i>.</li>

    <li>Let <i>constructorResult</i> be the result of calling the [[Call]] internal method of
    <i>constructor</i>, passing <i>promise</i> and (<i>executor</i>) as the arguments.</li>

    <li><es-xref target=
    "sec-returnifabrupt">ReturnIfAbrupt</es-xref>(<i>constructorResult</i>).</li>

    <li>If <es-xref target=
    "sec-iscallable">IsCallable</es-xref>(<i>promiseCapability</i>.[[Resolve]]) is <b>false</b>,
    then throw a <b>TypeError</b> exception.</li>

    <li>If <es-xref target="sec-iscallable">IsCallable</es-xref>(<i>promiseCapability</i>.
    [[Reject]]) is <b>false</b>, then throw a <b>TypeError</b> exception.</li>

    <li>If <es-xref target=
    "sec-ecmascript-data-types-and-values">Type</es-xref>(<i>constructorResult</i>) is Object and
    SameAs(<i>promise</i>, <i>constructorResult</i>) is <b>false</b>, then throw a <b>TypeError</b>
    exception.</li>

    <li>Return <i>promiseCapability</i>.</li>
  </ol>
</es-clause>
