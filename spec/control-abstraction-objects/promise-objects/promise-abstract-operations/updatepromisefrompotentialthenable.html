<!doctype html>
<es-clause title="UpdatePromiseFromPotentialThenable ( x, promiseCapability)" anchor=
"sec-updatepromisefrompotentialthenable">
  <p>The abstract operation UpdatePromiseFromPotentialThenable takes a value <es-nt>x</es-nt> and
  tests if it is a thenable. If so, it tries to use <i>x</i>'s <code>then</code> method to resolve
  the promised accessed through <es-nt>promiseCapability</es-nt>. Otherwise, it returns <code>"not
  a thenable"</code>.</p>

  <ol class="proc">
    <li>If <a href="#sec-ecmascript-data-types-and-values">Type</a> (<i>x</i>) is not Object,
    return <code>"not a thenable"</code>.
    </li>

    <li>Let <i>then</i> be the result of calling <a href="#sec-get-o-p">Get</a> (<i>x</i>,
    <code>"then"</code>).
    </li>

    <li>If <i>then</i> is an <a href="#sec-completion-record-specification-type">abrupt
    completion</a> ,

      <ol class="block">
        <li>Let <i>rejectResult</i> be the result of calling the [[Call]] internal method of
        <i>promiseCapability</i>.[[Reject]] with <b>undefined</b> as <i>thisArgument</i> and
        (<i>then</i>.[[value]]) as <i>argumentsList</i>.</li>

        <li>
          <a href="#sec-returnifabrupt">ReturnIfAbrupt</a> (<i>rejectResult</i>).
        </li>

        <li>Return <b>null</b></li>
      </ol>
    </li>

    <li>Let <i>then</i> be <i>then</i>.[[value]].</li>

    <li>If <a href="#sec-iscallable">IsCallable</a> (<i>then</i>) is <b>false</b>, return
    <code>"not a thenable"</code>.
    </li>

    <li>Let <i>thenCallResult</i> be the result of calling the [[Call]] internal method of
    <i>then</i> passing <i>x</i> as <i>thisArgument</i> and (<i>promiseCapability</i>.[[Resolve]],
    <i>promiseCapability</i>.[[Reject]]) as <i>argumentsList</i>.</li>

    <li>If <i>thenCallResult</i> is an <a href="#sec-completion-record-specification-type">abrupt
    completion</a> ,

      <ol class="block">
        <li>Let <i>rejectResult</i> be the result of calling the [[Call]] internal method of
        <i>promiseCapability</i>.[[Reject]] with <b>undefined</b> as <i>thisArgument</i> and
        (<i>thenCallResult</i>.[[value]]) as <i>argumentsList</i>.</li>

        <li>
          <a href="#sec-returnifabrupt">ReturnIfAbrupt</a> (<i>rejectResult</i>).
        </li>
      </ol>
    </li>

    <li>Return <b>null</b>.</li>
  </ol>
</es-clause>
